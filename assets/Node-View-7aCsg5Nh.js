import{r as g,m as P,L as J,o as F,c as u,b as d,e,j as h,n as N,t as w,G as I,w as B,A as V,E as c,B as L,h as D,D as R,d as T,F as q,f as A,H as E,J as G}from"./index-3rvIzVhp.js";import{T as U}from"./Top-Menu-DQ5GjE78.js";import{_ as j,B as O,F as z}from"./Back-Ground-DNITIm_t.js";const H={class:"modal-header"},K={class:"modal-title"},Q={class:"modal-body"},W={class:"form-group"},X={class:"form-group"},Y={class:"secret-input-group"},Z={class:"form-group"},ee={class:"modal-footer"},se=["disabled"],te={key:0,class:"loading-spinner"},ae={__name:"NodeEditDialog",props:{node:{type:Object,default:()=>({})},isEdit:{type:Boolean,default:!1},saving:{type:Boolean,default:!1}},emits:["close","save"],setup(y,{emit:M}){const i=y,b=M,n=g({name:"",secret:"",ip:""}),f=P(()=>n.value.name.trim()!==""&&n.value.secret.trim()!==""&&n.value.ip.trim()!==""&&m(n.value.ip)),m=l=>/^(?:(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.){3}(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)$/.test(l),_=()=>{const l="ABCDEFGHIJKLMNOPQRSTUVWXYZ",t="abcdefghijklmnopqrstuvwxyz",r="0123456789",k="!@#$%^&*()_+-=[]{}|;:,.<>?",C=l+t+r+k;let v="";v+=l[Math.floor(Math.random()*l.length)],v+=t[Math.floor(Math.random()*t.length)],v+=r[Math.floor(Math.random()*r.length)],v+=k[Math.floor(Math.random()*k.length)];for(let a=4;a<16;a++)v+=C[Math.floor(Math.random()*C.length)];const p=v.split("");for(let a=p.length-1;a>0;a--){const s=Math.floor(Math.random()*(a+1));[p[a],p[s]]=[p[s],p[a]]}n.value.secret=p.join(""),c.success("强密码已生成")},$=()=>{b("close")},S=async()=>{if(!f.value){c.error("请填写完整的节点信息");return}if(!i.saving)try{const l={id:i.isEdit?i.node.id:void 0,name:n.value.name.trim(),secret:n.value.secret.trim(),ip:n.value.ip.trim()};b("save",l)}catch(l){c.error("表单处理失败: "+l.message)}};return J(()=>i.node,l=>{l&&i.isEdit&&(n.value={name:l.name||"",secret:l.secret||"",ip:l.ip||""})},{immediate:!0}),F(()=>{i.isEdit&&i.node?n.value={name:i.node.name||"",secret:i.node.secret||"",ip:i.node.ip||""}:n.value={name:"",secret:"",ip:""};const l=()=>{};return document.addEventListener("reset-saving-state",l),()=>{document.removeEventListener("reset-saving-state",l)}}),(l,t)=>(d(),u("div",{class:"modal-overlay",onClick:$},[e("div",{class:"modal-content",onClick:t[5]||(t[5]=I(()=>{},["stop"]))},[e("div",H,[e("h2",K,[e("i",{class:N(y.isEdit?"fas fa-edit":"fas fa-plus")},null,2),h(" "+w(y.isEdit?"编辑节点":"新增节点"),1)]),e("button",{class:"modal-close",onClick:t[0]||(t[0]=r=>l.$emit("close"))},t[6]||(t[6]=[e("i",{class:"fas fa-times"},null,-1)]))]),e("div",Q,[e("form",{id:"node-form",onSubmit:I(S,["prevent"])},[e("div",W,[t[7]||(t[7]=e("label",{class:"form-label"},[e("span",null,"节点名称"),e("span",{class:"required"},"*")],-1)),B(e("input",{"onUpdate:modelValue":t[1]||(t[1]=r=>n.value.name=r),type:"text",class:"form-input",placeholder:"请输入节点名称",required:"",maxlength:"50"},null,512),[[V,n.value.name]])]),e("div",X,[t[9]||(t[9]=e("label",{class:"form-label"},[e("span",null,"节点密钥"),e("span",{class:"required"},"*")],-1)),e("div",Y,[B(e("input",{"onUpdate:modelValue":t[2]||(t[2]=r=>n.value.secret=r),type:"text",class:"form-input",placeholder:"请输入或生成节点密钥",required:"",minlength:"8",maxlength:"32"},null,512),[[V,n.value.secret]]),e("button",{type:"button",class:"generate-btn",onClick:_,title:"生成随机密钥"},t[8]||(t[8]=[e("i",{class:"fas fa-random"},null,-1),h(" 生成 ",-1)]))]),t[10]||(t[10]=e("div",{class:"form-hint"},"密钥长度为8-32位，建议使用生成的强密码",-1))]),e("div",Z,[t[11]||(t[11]=e("label",{class:"form-label"},[e("span",null,"IP地址"),e("span",{class:"required"},"*")],-1)),B(e("input",{"onUpdate:modelValue":t[3]||(t[3]=r=>n.value.ip=r),type:"text",class:"form-input",placeholder:"请输入IP地址（如：192.168.1.100）",required:"",pattern:"^(?:(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\\.){3}(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)$"},null,512),[[V,n.value.ip]]),t[12]||(t[12]=e("div",{class:"form-hint"},"请输入有效的IPv4地址格式",-1))])],32)]),e("div",ee,[e("button",{type:"button",class:"modal-btn secondary",onClick:t[4]||(t[4]=r=>l.$emit("close"))},t[13]||(t[13]=[e("i",{class:"fas fa-times"},null,-1),h(" 取消 ",-1)])),e("button",{type:"submit",class:"modal-btn primary",disabled:!f.value||i.saving,form:"node-form"},[i.saving?(d(),u("i",te)):(d(),u("i",{key:1,class:N(y.isEdit?"fas fa-save":"fas fa-plus")},null,2)),h(" "+w(i.saving?"保存中...":y.isEdit?"保存":"添加"),1)],8,se)])])]))}},oe=j(ae,[["__scopeId","data-v-8505e6c0"]]),ne={class:"home-view"},le={class:"node-container"},ie={class:"node-header"},re={class:"header-content"},de={class:"node-list"},ce={key:0,class:"loading-container"},ue={key:1,class:"empty-container"},me={key:2,class:"node-cards"},pe={class:"node-card-header"},ve={class:"node-info"},fe={class:"node-name"},ge={class:"node-id"},he={class:"node-actions"},ye=["onClick"],be=["onClick"],ke={class:"node-details"},we={class:"detail-row"},_e={class:"secret-field"},$e={key:0,class:"secret-hidden"},Ce={key:1,class:"secret-value"},Ee=["onClick","title"],Me=["onClick"],Se={class:"detail-row"},xe={class:"detail-value"},Be={__name:"Node-View",setup(y){const M=G("confirm"),i=g([]),b=g(!1),n=g(!1),f=g(null),m=g(!1),_=g(!1),$=async()=>{b.value=!0;try{const a=await E("/api/node/node.php","",{},{method:"GET"});a.status==="ok"?i.value=a.data.map(s=>({...s,showSecret:!1})):c.error(a.message||"加载节点数据失败")}catch(a){c.error("加载节点数据失败: "+a.message)}finally{b.value=!1}},S=a=>{const s=i.value.find(o=>o.id===a);s&&(s.showSecret=!s.showSecret)},l=async a=>{try{const s=p(a);await navigator.clipboard.writeText(s),c.success("密钥已复制到剪贴板")}catch{c.error("复制失败，请手动复制")}},t=()=>{f.value={id:"",name:"",secret:"",ip:""},m.value=!1,n.value=!0},r=a=>{f.value={...a},m.value=!0,n.value=!0},k=()=>{n.value=!1,f.value=null,m.value=!1},C=async a=>{_.value=!0;try{let s;if(m.value)s=await E("/api/node/node.php","update",a);else{const o=new FormData;o.append("name",a.name),o.append("secret",a.secret),o.append("ip",a.ip),s=await E("/api/node/node.php","add",o)}s.status==="ok"?(c.success(m.value?"节点更新成功":"节点添加成功"),k(),await $()):c.error(s.message||(m.value?"节点更新失败":"节点添加失败"))}catch(s){c.error("保存节点失败: "+s.message)}finally{_.value=!1}},v=async a=>{try{if(!await M.open({title:"确认删除",message:"确定要删除这个节点吗？",confirmButtonText:"确定",cancelButtonText:"取消"}))return;const o=await E("/api/node/node.php","delete",{id:a});o.status==="ok"?(c.success("节点删除成功"),await $()):c.error(o.message||"节点删除失败")}catch(s){c.error("删除节点失败: "+s.message)}},p=a=>{try{return atob(a)}catch{return a}};return F(async()=>{try{if(!await L())return;await $()}catch{}}),(a,s)=>(d(),u(q,null,[e("div",ne,[D(O),D(U)]),e("div",le,[e("div",ie,[e("div",re,[s[3]||(s[3]=e("h1",{class:"page-title"},[e("i",{class:"fas fa-network-wired"}),h(" 节点管理 ")],-1)),e("div",null,[e("button",{class:"add-node-btn",onClick:t},s[1]||(s[1]=[e("i",{class:"fas fa-plus"},null,-1),h(" 新增节点 ",-1)])),e("button",{class:"add-node-btn",onClick:s[0]||(s[0]=o=>a.$router.push("/extra"))},s[2]||(s[2]=[e("i",{class:"fas fa-terminal"},null,-1),h(" 安装命令 ",-1)]))])])]),e("div",de,[b.value?(d(),u("div",ce,s[4]||(s[4]=[e("i",{class:"fas fa-circle-notch fa-spin"},null,-1),e("span",null,"加载中...",-1)]))):i.value.length===0?(d(),u("div",ue,s[5]||(s[5]=[e("i",{class:"fas fa-server"},null,-1),e("p",null,"暂无节点数据",-1)]))):(d(),u("div",me,[(d(!0),u(q,null,A(i.value,o=>(d(),u("div",{key:o.id,class:"node-card"},[e("div",pe,[e("div",ve,[e("h3",fe,w(o.name),1),e("span",ge,"ID: "+w(o.id),1)]),e("div",he,[e("button",{class:"action-btn edit-btn",onClick:x=>r(o),title:"编辑"},s[6]||(s[6]=[e("i",{class:"fas fa-edit"},null,-1)]),8,ye),e("button",{class:"action-btn delete-btn",onClick:x=>v(o.id),title:"删除"},s[7]||(s[7]=[e("i",{class:"fas fa-trash"},null,-1)]),8,be)])]),e("div",ke,[e("div",we,[s[9]||(s[9]=e("span",{class:"detail-label"},"节点密钥:",-1)),e("div",_e,[o.showSecret?(d(),u("span",Ce,w(p(o.secret)),1)):(d(),u("span",$e,"••••••••••••••••")),e("button",{class:"secret-toggle",onClick:x=>S(o.id),title:o.showSecret?"隐藏密钥":"显示密钥"},[e("i",{class:N(o.showSecret?"fas fa-eye-slash":"fas fa-eye")},null,2)],8,Ee),o.showSecret?(d(),u("button",{key:2,class:"copy-btn",onClick:x=>l(o.secret),title:"复制密钥"},s[8]||(s[8]=[e("i",{class:"fas fa-copy"},null,-1)]),8,Me)):T("",!0)])]),e("div",Se,[s[10]||(s[10]=e("span",{class:"detail-label"},"IP地址:",-1)),e("span",xe,w(o.ip),1)])])]))),128))]))]),n.value?(d(),R(oe,{key:0,node:f.value,"is-edit":m.value,saving:_.value,onClose:k,onSave:C},null,8,["node","is-edit","saving"])):T("",!0)]),D(z)],64))}},Ie=j(Be,[["__scopeId","data-v-05c4e43f"]]);export{Ie as default};
